// OTB_YoutubeVideo React Component
//
// Generated by IC STRATEGY
//
// WARNING: Do not change this code; it will be overwritten by the next generation run!
//          Change the code only in the Visual Paradigm Project.

var DomainAPI = require('../domain-entity/DomainAPI');
import React from 'react';
import * as _ from 'lodash';

class OTB_YoutubeVideo extends React.Component {
    constructor(props) {
        super(props);
    };
    static defaultProps = {
        videoId: '',
        autoplay: 0,
        playerId: '',
        user: null
    };
    render() {
        var self = this;
        return(
            <div className="window">
                <div className="window-caption">
                    <span className="window-caption-icon"><span className="mif-youtube-play fg-red"></span></span>
                    <span className="window-caption-title">Youtube Video</span>
                </div>
                <div className="window-content">
                    <div className="video-container">
                        <iframe id={self.props.playerId} src={"https://www.youtube.com/embed/" + self.props.videoId + "?autoplay=" + self.props.autoplay + "&enablejsapi=1"} frameborder="0"></iframe>
                    </div>
                </div>
            </div>
        );
    };
    componentDidUpdate() {
        var self = this;
        var player = new YT.Player(self.props.playerId, {
            events: {
                'onStateChange': self.onStateChange
            }
        });
    };
    onStateChange = (event) => {
        var self = this;
        if(event.data == 0){
            console.log('VIDEO ENDED');
            DomainAPI.OTB_HistoryVideoCreate({videoUrl: 'https://youtu.be/' + self.props.videoId, historyUser: self.props.user}, self.props.user);
            DomainAPI.OTB_QueueVideoDelete(self.props.user.get('ownQueueVideos')[0], self.props.user);
        }
    };
};

export default OTB_YoutubeVideo;
